name: Multiline
# Validate schemas modified in an pull request or push against their given meta-schema (such as draft-07, etc.)
on:
  workflow_dispatch:
    inputs:
      target-acl-spec:
        type: string
        required: true
        # Default to no write for everyone except tm70_ci
        # TODO: This default will probably not work for other `remote-environment`s
        default: >-
          u::rwx,
          u:tm70_ci:rwx,
          g::r-x,
          m::rwx,
          o::---,
          d:u::rwx,
          d:u:tm70_ci:rwx,
          d:g::r-x,
          d:m::rwx,
          d:o::---
        description: ACL spec to be passed to `setfacl -m` for the given target
jobs:
  multiline:
    runs-on: ubuntu-latest
    container: rockylinux/rockylinux:8.10
    env:
      TEST_DIR: /opt/test
    steps:
      - name: Create Users
        run: |
          echo "${{ inputs.target-acl-spec }}"

      - name: Create Groups
        run: |
          echo "${{ inputs.target-acl-spec }}"

      - name: Verify Valid ACL Spec
        if: inputs.target-acl-spec != ''
        env:
          TEST_DIR: /opt/test
        run: |
          mkdir ${{ env.TEST_DIR }}
          setfacl --test --recursive --modify "${{ inputs.target-acl-spec }}" ${{ env.TEST_DIR }}
